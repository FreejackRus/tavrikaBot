# TavrikaBot — кнопочный интерфейс и экспорт только XLSX

Бот обновлён: команды заменены на кнопки, отчёты отправляются только в виде XLSX. Текстовые HTML-отчёты удалены из пользовательского потока.

## Структура проекта

Основные файлы:

```
bot.py         # Telegram-бот: кнопки «За сегодня», «Выбрать день», «Выбрать период»
iiko_client.py # Клиент IIKO: авторизация и OLAP byPresetId
cashflow.py    # Построение Excel отчёта (не изменён)
README.md      # Документация
requirements.txt
.env.example   # Пример переменных окружения
.gitignore
```

## Окружение

Создайте файл `.env` и заполните:

```
IIKO_BASE_URL=https://tavrika-wine-kitchen.iiko.it:443
IIKO_LOGIN=your_login
IIKO_PASSWORD=your_password
IIKO_OLAP_PRESET_ID=your_preset_id

TELEGRAM_BOT_TOKEN=your_bot_token
```

Авторизация в IIKO оставлена как в оригинальном проекте: сначала запрос `/resto/api/auth` для получения токена, затем параметр `key` используется в запросах OLAP.

## Режимы получения отчёта

Кнопки в чате:
- «За сегодня» — формирует XLSX по пресету `TRANSACTIONS` на текущий день.
- «Выбрать день» — открывает inline‑календарь; по выбранной дате бот отправляет XLSX.
- «Выбрать период» — выбирается дата начала и конца; бот экспортирует XLSX за период.

Отчёт ДДС отправляется только как файл .xlsx. Текстовые сообщения-отчёты удалены.

## Запуск

Установите зависимости:

```
python -m venv .venv
./.venv/Scripts/python -m pip install -r requirements.txt
```

Запуск Telegram‑бота:

```
./.venv/Scripts/python bot.py
```

После запуска отправьте `/start` и используйте кнопки меню. Команда `/cashflow` и текстовые отчёты больше не используются.

Файл XLSX сохраняется локально рядом с ботом (например, `YYYY-MM-DD_ДДС.xlsx`) и отправляется в чат.

## Запуск в Docker

Соберите образ:

```
docker build -t tavrika-bot .
```

Подготовьте `.env` (см. выше) и запустите контейнер, передав переменные окружения:

```
docker run --rm --name tavrika-bot --env-file .env tavrika-bot
```

Контейнер не открывает порты: бот подключается к Telegram API и IIKO по исходящим соединениям. Логи работы выводятся в stdout.