# Tavrika Bot

Telegram-бот для отчётов ДДС и балансов IIKO.

## Быстрый старт

1. Установите Python 3.11+ и создайте виртуальное окружение:
   - Windows (PowerShell):
     ```powershell
     python -m venv .venv
     .venv\Scripts\Activate.ps1
     ```
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Настройте переменные окружения:
   - Создайте `.env` на основе `.env.example`
   - Укажите `IIKO_BASE_URL`, `IIKO_LOGIN`, `IIKO_PASSWORD`, `TELEGRAM_BOT_TOKEN`
4. Запуск бота:
   ```bash
   python bot.py
   ```

## Команды бота

- `/start` — приветственное сообщение
- `/cashflow` — отчёт ДДС за вчера/сегодня
- `/cashflow YYYY-MM-DD` — отчёт ДДС за один день (сравнение с предыдущим)
- `/cashflow YYYY-MM-DD YYYY-MM-DD` — отчёт ДДС за период

## Что внутри

- `bot.py` — Telegram-бот, формирование сообщения и отправка Excel
- `cashflow.py` — построение сводной и детальной таблиц ДДС, экспорт
- `iiko_client.py` — простой клиент IIKO OLAP (TRANSACTIONS)

## Примечания

- В отчёте учитываются оба типа деятельности: `Операционная деятельность` и `Финансовая деятельность`.
- Категории нормализуются на русский (`Loan/Loans` → `Займ`).
- Расходы выводятся с минусом, приходы — положительные.
- Балансы на начало/конец берутся из строк без категории.
